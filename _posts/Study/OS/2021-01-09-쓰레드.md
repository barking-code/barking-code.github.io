---
layout: post
title: "쓰레드"
categories:
  - Study
  - OS
tags:
  - OS
created_at: 2021-01-09T23:16:00+09:00
modified_at: 2021-01-09T23:16:00+09:00
visible: true
---

## 쓰레드란?

> 프로세스 내에서 수행되는 **작업의 단위**

프로세스가 1개의 프로세서를 할당받아 프로그램을 실행하는 프로세서 할당 단위라면, 쓰레드는 프로세스 내에서 프로세스가 할당받은 자원을 사용해 1개의 작업을 수행하는 작업 단위라고 할 수 있다. 프로세스는 **작업을 수행하기 위해** 프로세서를 할당 받기 때문에 어떤 **프로세스가 존재**한다면 어떤 **작업을 수행**한다는 뜻이고 어떤 **작업이 수행**된다는 이야기는 **쓰레드가 존재**한다는 이야기이다.

즉, 프로세스 내에는 반드시 1개의 쓰레드가 존재하고 멀티 쓰레드 프로그램을 작성한다면 다수의 쓰레드가 존재 할 수도 있다. 쓰레드는 프로세스가 할당받은 자원을 공유하여 사용한다.

---

## 쓰레드 종류

> 쓰레드는 크게 사용자 수준 쓰레드, 커널 수준 쓰레드, 혼합형 쓰레드로 구분된다.

### 사용자 수준 쓰레드

* 쓰레드의 생성, 소멸, 관리 등을 사용자 수준(응용 프로그램)에서 수행한다.
* 커널은 1개의 프로세서에 1개의 프로세스를 할당 할 뿐 프로세스 안에 존재하는 쓰레드의 존재는 알지못하고, 관여하지도 않는다.
* 커널 쓰레드를 지원하지 않는 운영체제에서 주로 사용된다(1쓰레드 = 1프로세스).
* 1개의 커널 쓰레드에 다수의 사용자 수준 쓰레드가 매핑되어 1:N 쓰레드 매핑이 이루어진다.
* 다수의 사용자 수준 쓰레드가 하나의 커널 수준 쓰레드(프로세스)와 맵핑되어 1개의 쓰레드가 시스템을 호출 할 경우 다른 쓰레드는 시스템 호출을 할 수 없다

### 커널 수준 쓰레드

* 쓰레드가 커널 수준 쓰레드에 1:1 맵핑되어 커널에 의해 관리 됨
* 쓰레드가 1:1 맵핑되기 때문에 시스템 호출이 자유롭다.
* 커널에서 쓰레드를 생성하기 때문에 오버헤드가 증가해 쓰레드의 수를 제한해야한다.

### 혼합형 쓰레드

* 사용자가 쓰레드를 생성하고 커널 수준 쓰레드와 M:N 맵핑되어 커널에서 쓰레드가 관리된다.

* 시스템 호출이 제한되는 사용자 수준 쓰레드와 쓰레드 수의 제한이 존재하는 커널 수준 쓰레드의 단점을 극복할 수 있다.

---

## 쓰레드 메모리 구조

쓰레드는 프로세스에서 할당받은 자원을 공유하여 사용하기 때문에 다른 쓰레드와 일정부분 공유하는 데이터가 존재한다.

Code, Data, Heap 영역을 공유하고 쓰레드 별로 Stack 영역을 프로세스로 부터 할당받아 사용한다.

![image-20210109165914338](../../assets/img/2021-01-09-%EC%93%B0%EB%A0%88%EB%93%9C/쓰레드메모리구조.png)

---

## 멀티 프로세스와 멀티 쓰레드

### 멀티 프로세스

* 하나의 프로그램이 다수의 프로세스를 생성하여 각 프로세스마다 작업을 수행하도록 프로그램을 설계한 것
* 프로세스는 Code, Data, Heap, Stack 영역을 전부 할당받고 독립적으로 사용하기 때문에 프로세스 교체 시마다 메모리에 모든 할당 영역을 다시 load해야 하기 때문에 Context Switching에 많은 시간이 걸린다(오버헤드가 커짐).
* 또한 하나의 프로그램을 다수의 프로세스가 수행하기 때문에 각자 수행한 결과, 가지고 있는 데이터등을 공유해야하는데 프로세스는 독립적인 영역에서 수행되기 때문에 직접 값을 참조할 수 없고 프로세스간 통신(IPC, Inter Process Communication)을 통해 정보를 교환해야한다.

* 반대로 모든 영역을 독립적으로 할당받는다는 점때문에 하나의 프로세스가 비정상적으로 종료되더라도 전체 프로그램 동작에 영향을 미치지 않는다.(나머지 프로세스는 잘 동작)



### 멀티 쓰레드

* 프로세스 내에 1개의 쓰레드가 존재하는 것이 아닌 다수의 쓰레드를 생성하여 작업을 수행하는 것
* 프로세스의 정보를 PCB에 저장하고 교체되며 사용하는 것처럼 쓰레드의 정보도 TCB에 저장하고 교체되며 사용된다. TCB는 PCB에 비해 저장되는 정보의 양이 적다.
* 프로세스가 할당받은 자원을 다수의 쓰레드가 공유하여 사용한다.
* 쓰레드는 Code, Data, Heap 영역은 쓰레드가 공유하여 사용하고, Stack영역만 독립적으로 할당받아 사용한다. 따라서 Context Switching에 상대적으로 시간이 적게 걸린다(오버헤드가 적다).

* 또한 데이터를 공유하기 때문에 다수의 쓰레드에서 정보를 공유하기가 수월하다.
* 반대로 데이터를 공유한다는 점 때문에 데이터가 오염될 가능성이 존재해 프로그래밍 과정에서 주의가 필요하다(동시에 두 개 이상의 쓰레드가 데이터를 읽고 쓰는 경우 등).