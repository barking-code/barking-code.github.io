---
layout: post
title: "[Ubuntu]SSL인증서 발급받기"
categories:
  - Study
  - etc
tags:
  - HTTP
  - SSL
  - Ubuntu
created_at: 2021-01-06T17:31:00+09:00
modified_at: 2021-01-06T17:31:00+09:00
visible: true
---

## SSL이란?

>  HTTP를 통한 클라이언트와 서버간의 연결에서 보안을 유지하기 위해 추가된 프로토콜

* HTTP를 통해 클라이언트-서버간의 민감한 데이터가 오갈때 제 3자에 의해 탈취될 가능성이 존재
* 이를 방지하기 위해 클라이언트-서버간의 통신에서 데이터를 암호화 해야 한다

* 클라이언트는 공개키를 갖고 데이터 전송 서버는 대칭키를 갖고 복호화
  * 이때 공개키-개인키는 대친키에 비해 암호화-복호화에 시간이 오래 걸리므로
  * 클라이언트는 대칭키로 암호화
  * 대칭키를 공개키로 암호화 하여 서버에 같이 전송
  * 서버는 개인키로 대칭키를 복호화
  * 복호화된 대칭키로 데이터 복호화 과정을 거친다.

* 위 같은 과정을 거치더라도 유사 도메인(naver -> rIaver)등으로 인한 피해가 발생가능하다
* 따라서 도메인 자체에 대한 인증도 필요하다.
* 도메인 자체를 제 3자(인증기관, CA)가 인증하고 인증서를 발급하여 피해를 방지한다



## HTTPS 통신 과정

### SSL 인증서 발급

* 도메인을 소유한 사람이 CA에 인증을 요청한다

* CA의 검증 후 해당 도메인에 대한 **공개키와 인증서**를 인증기관의 개인키로 암호화하여 보관
  * 참고: CA의 공개키는 브라우저에 내장되어있다.



### 클라이언트 요청

1. 클라이언트가 서버에 요청
2. 서버는 클라이언트에게 CA의 개인키로 암호화된 인증서를 보냄
3. 클라이언트는 인증서를 받아 브라우저에 내장된 CA의 공개키로 복호화
   * 이 과정에서 이루어지는 복호화 자체가 CA에 인증받은 서버임을 의미한다.
4. 클라이언트는 대칭키를 생성하고 복호화를 통해 얻은 도메인의 공개키를 사용해 대칭키 암호화
5. 암호화된 대칭키를 서버에 전달
6. 서버는 암호화된 대칭키를 개인키를 통해 복호화
7. 양측에서 대칭키를 안전하게 가지고 있기 때문에 대칭키를 통해 암호화-복호화 하여 통신



## Let's Encrypt을 통해 SSL 인증서 발급받기

* 대부분의 CA에서는 인증서 발급을 위해 꽤 많은 비용을 요구하는데 그럴 돈이 없으므로 무료 CA인 Let's Encrypt에서 발급을 받아보도록 한다.

* AIGARET 프로젝트에 SSL을 적용하기 위한 방법이다.(Nginx 기준)
* SSL 인증서는 서버에서 클라이언트로 제공해줘야 하므로 서버(프로그램)이 요구하는 위치에 key가 저장되어 있어야 한다.



### 1. certbot 설치(확인)

* nginx 컨테이너에 접속하여 certbot을 설치한다.

  ```bash
  apt install certbot -y
  ```

* nginx 플러그인 설치

  ```bash
  apt install python3-certbot-nginx -y
  ```

* 아래 명령어로 설치 확인

  ```bash
  apt --installed list | grep certbot
  ```

  ![image-20210106003940759](../../assets/img/2021-01-06-SSL%EC%9D%B8%EC%A6%9D%EC%84%9C-%EB%B0%9C%EA%B8%89%EB%B0%9B%EA%B8%B0/apt-list.png)

  

### 2. 인증서 발급받기

* 다음 명령어를 통해 인증서를 발급받는다.

  ```bash
  certbot certonly --nginx
  ```

* 어느 도메인을 인증 받을지 선택(둘 다)

  ![image-20210106014012392](../../assets/img/2021-01-06-SSL%EC%9D%B8%EC%A6%9D%EC%84%9C-%EB%B0%9C%EA%B8%89%EB%B0%9B%EA%B8%B0/certbot.png)

* 성공

  ![image-20210106014349183](../../assets/img/2021-01-06-SSL%EC%9D%B8%EC%A6%9D%EC%84%9C-%EB%B0%9C%EA%B8%89%EB%B0%9B%EA%B8%B0/cert-success.png)

* 해당 경로로 찾아가보면 pem파일이 생성되어 있는 것을 확인 할 수 있다.
* 이것을 서버에 적용하기 위해 nginx 설정을 변경해주어야한다
* 그 과정은 [추후 작성 예정]()