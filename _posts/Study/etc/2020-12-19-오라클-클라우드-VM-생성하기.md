---
layout: post
title: "오라클 클라우드 VM 생성하기"
categories:
  - Study
  - etc
tags:
  - Cloud
created_at: 2020-12-19T16:20:00+09:00
modified_at: 2020-12-19T16:20:00+09:00
visible: true
---

깃허브 페이지에 SSAFY에서 진행한 프로젝트를 올리는 와중에 문제가 발생했다.<br/>

SSAFY에서 진행한 프로젝트는 SSAFY에서 제공하는 AWS인스턴스 위에 올라가 있었는데 SSAFY가 끝난 지금은 AWS인스턴스를 회수 해버려서 더이상 접근이 불가능했다.<br/>

하지만 소스코드를 가지고 있기 때문에 다시 클라우드 위에 서버를 올려서 포트폴리오 작성에 필요한 스크린샷을 찍기로 했다.<br/>

다양한 클라우드 서비스를 확인하던 도중 오라클 클라우드 freetire가 조건이 가장 괜찮아 보이기에 사용해보기로 했다.<br/>



**아래 작성한 모든 내용은 [Taewan.kim 님의 오라클 사용자 가이드](http://taewan.kim/oci_docs/)를 참고하여 진행했습니다.**



1. 계정 생성하기

   * 계정 생성을 위해서는 master, visa, amex 중 한개의 카드가 필요하다.
   * 계정 업그레이드를 하지 않으면 freetire가 계속 유지된다고 하니 안심해도 될것 같다.

2. 프로젝트 관리를 위한 Compartment 생성하기

   * 서비스에서 사용하는 자원을 논리적으로 묶는 단위를 Compartment라고 한다.

   * 특정 자원에 대한 보안과 접근제어를 설정할때 Compartment단위로 제어가 가능하다고 한다.

   * 햄버거버튼 -> ID -> 구획으로 접속

     ![image-20201219142505250](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/구획생성1.png)

   * 구획생성 버튼으로 aigaret 프로젝트를 위한 구획을 생성한다

     ![image-20201219142641418](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/구획생성2.png)

3. VCN(Virtual Cloud Network) 구성하기

   * 생성한 VM 인스턴스가 서버로 동작하기 위해서는 네트워크에 연결이 되어있어야 한다.

   * VM 인스턴스가 위치하기위한 네트워크를 생성하고 방화벽 규칙과 네트워크 설정을 셋팅하기 위한 VCN을 생성한다.

   * 햄버거 버튼 ->  네트워킹 -> 가상 클라우드 네트워크 클릭 -> **VCN 마법사 시작**

     ![image-20201219143806168](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/VCN생성1.png)

   * VCN이름과 아까 생성한 Compartment를 선택 후 **다음** 버튼 -> **생성** 버튼

     ![image-20201219144249370](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/VCN생성2.png)

   * 다음과 같이 VCN 생성이 완료된다.

     ![image-20201219144423862](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/VCN생성3.png)

   * 생성이 완료된 후 **가상 클라우드 네트워크 보기** 버튼 또는 햄버거버튼 -> 네트워킹 -> 가상 클라우드 네트워크 -> 생성된 VCN 이름을 클릭하면 다음과 같은 화면을 볼 수 있다.

     ![image-20201219145158327](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/VCN생성4.png)

   * 인스턴스를 서버로 사용하기 위해서 외부에서 접근이 가능하도록 80 포트를 여는 작업이 필요하다

   * 공용 서브넷-{VCN 이름} -> Default Security List for {VCN 이름} -> 수신 규칙 추가

     ![image-20201219145257380](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/VCN생성5.png)

   * 설정 설명

     * 소스 CIDR: 모든 사용자로부터 접근을 허용하기 위해 0.0.0.0/0 으로 설정
     * 대상 포트 범위: 개방할 포트 선택
     * 설명 : 간단한 설명 입력

     ![image-20201219145736726](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/VCN생성6.png)

   * https 접속이 필요한 경우 443 포트도 같은 방법으로 개방하면 된다.

4. SSH key 생성하기

   * SSH는 암호키를 바탕으로 다른 컴퓨터와 안전한 통신을 하기위한 프로토콜이다.

   * 일반적으로 22번 포트를 통해 통신하며 VCN 네트워크 생성시 기본적으로 22번포트는 개방되어 있는 것을 확인 할 수 있다.

   * SSH를 통해 내 컴퓨터에서 클라우드 상의 VM 인스턴스를 원격제어하기 위해 SSH key를 생성한다.

   * 옵션 설명

     * -t: 암호화 방식
     * -N: passphrase(일종의 비밀번호로 타인이 SSH key 를 획득하더라도 passphrase를 알아야 사용이 가능하다)
     * -b: 암호화 비트수
     * -C: comment
     * -f: ssh key가 생성될 파일 경로/key 이름

     ![image-20201219151712680](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/SSH생성1.png)

   * 다음과 같이 경로에 키가 생성된 것을 확인 할 수 있다.

     ![image-20201219152421871](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/SSH생성2.png)

5. 인스턴스 생성하기

   * 햄버거 버튼 -> 컴퓨트 -> 인스턴스 -> **Create Instance** 버튼 클릭

   ![image-20201219152629119](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/VM생성1.png)

   * 오른쪽의 편집버튼을 누르면 원하는 설정으로 변경이 가능하다.

   ![image-20201219152546016](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/VM생성2.png)

   * 나는 기존의 AWS 인스턴스와 동일하게 ubuntu 16.04 로 변경했다.

   ![image-20201217181354794](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/VM생성3.png)

   * 아까 생성한 VCN이 잘 설정되었는지 확인한다.

     ![image-20201219152831782](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/VM생성4.png)

   * 아까 생성한 SSH 키를 추가한다.

     ![image-20201219152901722](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/VM생성5.png)

   * 생성버튼을 클릭하면 인스턴스 생성이 완료된다.

6. 인스턴스 접속해보기

   * 생성된 인스턴스의 public ip와 ssh key를 사용하여 접속해보자.

   * ssh 키가 위치한 디렉토리에서 bash를 연 후 다음과 같이 입력한다.

     ![image-20201219154533543](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/접속1.png)

   * 성공~!

     ![image-20201219154650162](../../assets/img/2020-12-19-오라클-클라우드-VM-생성하기/접속2.png)
     
   * **TIP** alias 설정하기
   
   * 나는 git bash를 주로 사용하기 때문에 git bash 에 alias 설정을 통해 커맨드를 단축시키기로 했다.
   
   * git이 설치되어있는 디렉토리에 profile에 다음과 같이 alias를 작성한다.
   
     ```
     alias {원하는 alias 이름}='ssh -i {ssh key 이름} ubuntu@{public ip 주소}'
     ```
   
   * 이제 ssh key 가 있는 디렉토리에서 alias 이름만 입력하면 인스턴스에 접속할 수 있게 된다.